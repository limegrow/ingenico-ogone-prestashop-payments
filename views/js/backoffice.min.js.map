{"version":3,"sources":["backoffice.js"],"names":["Ingenico","init","$","click","e","length","isValid","forEach","item","index","arr","el","val","openModal","preventDefault","toggleClass","removeProp","prop","document","on","modal_id","target","data","getPaymentMethodModal","this","find","first","setTimeout","toggle","hasSomeParentTheClass","closeModal","hasClass","change","toggle_target","reverse","is","parseInt","slideUp","slideDown","hide","show","keyup","query","filterCountries","filterPaymentMethods","filename","split","pop","html","getModalPaymentMethods","payment_methods","includes","addPaymentMethod","getSelectedPaymentMethods","disableAfterpayOrKlarnaMethods","selected","removePaymentMethod","ajax","ingenico_ajax_url","method","country","dataType","success","window","OPENINVOICE_METHOD","addCountries","installments_amount_min","slider","range","min","max","values","installments_amount_max","slide","event","ui","min_value","max_value","remove","handler","eq","append","amount_handler","installments_period_min","installments_period_max","period_handler","installments_first_min","installments_first_max","first_handler","input","attr","text","hash","location","panel","removeClass","parent","addClass","href","connectExistingAccount","keydown","keyCode","the_terms","removeAttr","pattern","getRandomByte","crypto","getRandomValues","result","Uint8Array","msCrypto","Math","floor","random","generateHash","field","generated_hash","Array","apply","map","String","fromCharCode","test","join","getElementsByName","value","copyValue","copy_response_container","createElement","setAttribute","style","position","left","body","appendChild","select","execCommand","removeChild","copyLink","link","toggleTooltip","tooltip","x","getElementById","display","options","onShow","elm","scrollTop","modal","animate","onClose","selected_countries","each","promise","done","callback","concat","push","afterpay","klarna","all","payment_method","fadeOut","element","classname","tagName","className","indexOf","parentNode","showMigrationUI","createAccount","css","backToInstallation","registerAccount","validateEmail","account_info","serialize","email","trim","match","countries","openinvoice_countries","checked","country_code","label","closest","replace","fetchPaymentMethods","openinvoice_method","openinvoice","addMigrationLog","message","scrollHeight","height","doMigrationAction","action","migration_ajax_url","fail","jqXHR","textStatus","errorThrown","JSON","stringify","doMigrate","async","series","step1","step2","step3","step4","step5","err","aliases","aliases_count","aliases_imported","eachSeries","alias_id","callback1","data1","always","console","log","value1","step6","results"],"mappings":"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","file":"backoffice.min.js","sourcesContent":["/**\n * 2007-2021 Ingenico\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Academic Free License (AFL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http://opensource.org/licenses/afl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to contact@ingenico.com we can send you a copy immediately.\n *\n *  @author    Ingenico <contact@ingenico.com>\n *  @copyright 2007-2021 Ingenico\n *  @license   http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)\n */\n\"use strict\"\n\nconst Ingenico = {\n\n    init: function () {\n\n        $('.ingenico-header .switch.test-live-toggle').click(function(e) {\n            if ($('.ingenico-header .switch.test-live-toggle input:checked').length > 0) {\n                // Check if live configured.\n                const requiredFields = [\n                    'connection_live_pspid',\n                    'connection_live_signature',\n                    'connection_live_dl_user',\n                    'connection_live_dl_password',\n                ];\n\n                var isValid = true;\n                requiredFields.forEach(function(item, index, arr) {\n                    let el = $('[name=\"' + item + '\"]');\n                    if (el.length === 0 || el.val().length === 0) {\n                        isValid = false;\n                    }\n                });\n\n                if (!isValid) {\n                    Ingenico.openModal('credentials-live-validation-modal');\n                    e.preventDefault();\n                    return false;\n                } else {\n                    // Set Live is \"On\"\n                    $('[name=connection_mode]').val('on');\n                    $('.ingenico-header, .ingenico-settings').toggleClass('test').toggleClass('live');\n\n                    $('[name=\"connection_test_pspid\"],[name=\"connection_test_signature\"],[name=\"connection_test_dl_user\"],[name=\"connection_test_dl_password\"]').removeProp('required');\n                    $('[name=\"connection_live_pspid\"],[name=\"connection_live_signature\"],[name=\"connection_live_dl_user\"],[name=\"connection_live_dl_password\"]').prop('required', true);\n                }\n            } else {\n                // Set Live is \"Off\"\n                $('[name=connection_mode]').val('off');\n                $('[name=\"connection_live_pspid\"],[name=\"connection_live_signature\"],[name=\"connection_live_dl_user\"],[name=\"connection_live_dl_password\"]').removeProp('required');\n                $('[name=\"connection_test_pspid\"],[name=\"connection_test_signature\"],[name=\"connection_test_dl_user\"],[name=\"connection_test_dl_password\"]').prop('required', true);\n            }\n        });\n\n        $(document).on('click', '.ingenico-settings .modal-link', function (e) {\n            e.preventDefault();\n            const modal_id = $(e.target).data('modal-id');\n            if (modal_id === 'payment-methods-list') {\n                Ingenico.getPaymentMethodModal();\n            }\n\n            Ingenico.openModal(modal_id);\n        });\n\n        $(document).on( 'click', '.account-header', function (e) {\n            let el = $(this);\n            if ( el.prop('disabled') ) {\n                e.preventDefault();\n                return false;\n            }\n\n            el.prop( 'disabled', true );\n            el.find( '.collapse-btn' ).first().click();\n\n            setTimeout(function () {\n                el.prop( 'disabled', false );\n            }, 500);\n        } );\n\n        $(document).on( 'click', '.account-header', function (e) {\n            // Toggle Show and Hide labels\n            $(this).find( 'span' ).toggle();\n        } );\n\n        $('.modal-dialog .close, .modal-backdrop, .ingenico-modal').click(function(e) {\n            if (Ingenico.hasSomeParentTheClass(e.target, 'modal-dialog')) {\n                if(!Ingenico.hasSomeParentTheClass(e.target, 'close')) {\n                    return;\n                }\n            }\n\n            e.preventDefault();\n            Ingenico.closeModal();\n        });\n\n        $('.switch > input').click(function (e) {\n            if ($(this).hasClass('disabled')) {\n                e.preventDefault();\n                return false;\n            }\n        });\n\n        $('.switch > input').change(function () {\n            let toggle_target = $(this).data('toggle-name');\n            let reverse = $(this).data('toggle-reverse');\n            let checked = $(this).is(':checked');\n            if (checked) {\n                if (parseInt(reverse) === 1) {\n                    $('.' + toggle_target).slideUp();\n                } else {\n                    $('.' + toggle_target).slideDown();\n                }\n            } else {\n                if (parseInt(reverse) === 1) {\n                    $('.' + toggle_target).slideDown();\n                } else {\n                    $('.' + toggle_target).slideUp();\n                }\n            }\n        });\n\n        $('.radio > input').change(function () {\n            let val = $(this).val();\n            let toggle_target = $(this).data('toggle-name');\n            $('.' + toggle_target).slideUp();\n            $('.' + toggle_target + val).slideDown();\n            //IE-89\n            // Inline method always have \"Ingenico\" template\n            if(toggle_target + val === 'paymentpage_typeINLINE') {\n                $('#template_manager').click();\n                $('[name=paymentpage_template_name]').hide();\n            } else {\n                $('[name=paymentpage_template_name]').show();\n            }\n        });\n\n        $('[name=paymentpage_type]').change(function () {\n            if ($(this).val() === 'REDIRECT') {\n                $('.step1.inline').hide();\n                $('.step1.redirect').show();\n                $('.ppt.inline').hide();\n                $('.ppt.redirect').show();\n            } else if ($(this).val() === 'INLINE') {\n                $('.step1.redirect').hide();\n                $('.step1.inline').show();\n                $('.ppt.redirect').hide();\n                $('.ppt.inline').show();\n            }\n        });\n\n        $('.toggle-field').click(function(e) {\n            e.preventDefault();\n            Ingenico.closeModal();\n        });\n\n        $('.country-list').keyup(function() {\n            var query = $(this).val();\n            Ingenico.filterCountries(query);\n        });\n\n        $('.payment-methods-list').keyup(function() {\n            var query = $(this).val();\n            Ingenico.filterPaymentMethods(query);\n        });\n\n        // Support: Export Settings Button\n        $(document).on('click', '#export-settings', function (e) {\n            e.preventDefault();\n            $('#submitExportSettings').click();\n        });\n\n        $(document).on('change', 'input[type=file]#support-import', function (e) {\n            const filename = $('input[type=file]#support-import').val().split('\\\\').pop();\n            $('#support .upload-label').html(filename);\n        });\n\n        // Support: Show Upload Confirmation Modal\n        $(document).on('click', '#modalImportSettings', function (e) {\n            e.preventDefault();\n            Ingenico.openModal('upload-confirmation-modal');\n        });\n\n        // Support: Import Settings Button\n        $(document).on('click', '#submitModalImportSettings', function (e) {\n            e.preventDefault();\n            $('#submitImportSettings').click();\n        });\n\n        // Button: Add more payment methods / Apply\n        $(document).on( 'click', '[name=submit_save_payments]', function (e) {\n            e.preventDefault();\n\n            Ingenico.getModalPaymentMethods(function (payment_methods) {\n                if (payment_methods.includes('afterpay') || payment_methods.includes('klarna') ) {\n                    // Show \"Choose Country\" modal\n                    Ingenico.openModal('openinvoice-choose-country-modal');\n                }\n\n                // Save payment methods\n                Ingenico.addPaymentMethod();\n            });\n        });\n\n        // Payment methods list: Only one of the two Open Invoice PMs can be selected\n        $(document).on( 'click', '#payment-methods-list input[name=\"payment_methods[]\"]', function (e) {\n            Ingenico.getSelectedPaymentMethods(function (payment_methods) {\n                Ingenico.disableAfterpayOrKlarnaMethods(payment_methods);\n            });\n        });\n\n        // OpenInvoice: Choose Country\n        $(document).on( 'click', '#openinvoice-choose-country-modal .apply', function () {\n            let selected = $('[name=openinvoice_country]:checked').val();\n            if (selected === '') {\n                // Unset all OpenInvoice methods\n                Ingenico.removePaymentMethod('afterpay');\n                Ingenico.removePaymentMethod('klarna');\n            }\n\n            $('[name=generic_country]').val(selected);\n\n            $.ajax( ingenico_ajax_url, {\n                'method': 'POST',\n                'data': {\n                    method: 'set_merchant_country',\n                    country: selected\n                },\n                'dataType': 'json'\n            } ).success(function(data) {\n                Ingenico.closeModal('openinvoice-choose-country-modal');\n            } );\n        } );\n\n        // OpenInvoice: Select method\n        $(document).on( 'click', '#openinvoice-select-payment-modal .apply', function () {\n            window.OPENINVOICE_METHOD = $('[name=openinvoice_method]:checked').val();\n            Ingenico.closeModal('openinvoice-select-payment-modal', function () {\n                Ingenico.addCountries();\n            });\n        } );\n\n        $(document).on( 'keyup', '.payment-methods-list', function (e) {\n            const query = $(this).val();\n            Ingenico.filterPaymentMethods(query);\n        });\n\n        if (typeof installments_amount_min !== 'undefined') {\n            $('#installments_amount_range').slider({\n                range: true,\n                min: 1,\n                max: 24,\n                values: [installments_amount_min, installments_amount_max],\n                slide: function (event, ui) {\n                    let min_value = ui.values[0];\n                    let max_value = ui.values[1];\n                    $('[name=instalments_flex_instalments_min]').val(min_value);\n                    $('[name=instalments_flex_instalments_max]').val(max_value);\n\n                    $('#installments_amount_range .ui-slider-handle b').remove();\n                    let handler = $('#installments_amount_range .ui-slider-handle');\n                    handler.eq(0).append(\"<b class='amount left-handler'><span id='min'>\" + min_value + \"</span></b>\");\n                    handler.eq(1).append(\"<b class='amount right-handler'><span id='max'>\" + max_value + \"</span></b>\");\n                }\n            });\n            let amount_handler = $('#installments_amount_range .ui-slider-handle');\n            amount_handler.eq(0).append(\"<b class='amount left-handler'><span id='min'>\" + installments_amount_min + \"</span></b>\");\n            amount_handler.eq(1).append(\"<b class='amount right-handler'><span id='max'>\" + installments_amount_max + \"</span></b>\");\n\n            $('#installments_period_range').slider({\n                range: true,\n                min: 1,\n                max: 90,\n                values: [installments_period_min, installments_period_max],\n                slide: function (event, ui) {\n                    let min_value = ui.values[0];\n                    let max_value = ui.values[1];\n                    $('[name=instalments_flex_period_min]').val(min_value);\n                    $('[name=instalments_flex_period_max]').val(max_value);\n                    $('#installments_period_range .ui-slider-handle b').remove();\n                    let handler = $('#installments_period_range .ui-slider-handle');\n                    handler.eq(0).append(\"<b class='amount left-handler'><span id='min'>\" + min_value + \"</span></b>\");\n                    handler.eq(1).append(\"<b class='amount right-handler'><span id='max'>\" + max_value + \"</span></b>\");\n                }\n            });\n            let period_handler = $('#installments_period_range .ui-slider-handle');\n            period_handler.eq(0).append(\"<b class='amount left-handler'><span id='min'>\" + installments_period_min + \"</span></b>\");\n            period_handler.eq(1).append(\"<b class='amount right-handler'><span id='max'>\" + installments_period_max + \"</span></b>\");\n\n            $('#installments_first_range').slider({\n                range: true,\n                min: 1,\n                max: 99,\n                values: [installments_first_min, installments_first_max],\n                slide: function (event, ui) {\n                    let min_value = ui.values[0];\n                    let max_value = ui.values[1];\n                    $('[name=instalments_flex_firstpayment_min]').val(min_value);\n                    $('[name=instalments_flex_firstpayment_max]').val(max_value);\n                    $('#installments_first_range .ui-slider-handle b').remove();\n                    let handler = $('#installments_first_range .ui-slider-handle');\n                    handler.eq(0).append(\"<b class='amount left-handler'><span id='min'>\" + min_value + \"%</span></b>\");\n                    handler.eq(1).append(\"<b class='amount right-handler'><span id='max'>\" + max_value + \"%</span></b>\");\n                }\n            });\n            let first_handler = $('#installments_first_range .ui-slider-handle');\n            first_handler.eq(0).append(\"<b class='amount left-handler'><span id='min'>\" + installments_first_min + \"%</span></b>\");\n            first_handler.eq(1).append(\"<b class='amount right-handler'><span id='max'>\" + installments_first_max + \"%</span></b>\");\n        }\n\n        $('.form-btn.mask').click(function() {\n            var input = $('[name=\"' + $(this).attr('toggle') +'\"]');\n            if (input.attr('type') == 'password') {\n                $(this).text($(this).data('hide'));\n                input.attr('type', 'text');\n            } else {\n                $(this).text($(this).data('show'));\n                input.attr('type', 'password');\n            }\n        });\n\n        let hash = window.location.hash;\n        if (typeof(hash) != \"undefined\" && hash !== null && hash !== '') {\n            let panel = $('#content.bootstrap .ingenico-settings .form-wrapper .panel-footer');\n            if (hash === '#support') {\n                // Hide Save button in bottom\n                panel.hide();\n            } else {\n                panel.show();\n            }\n\n            $('.nav-tabs li').removeClass('active');\n            $('.tab-content .tab-pane').removeClass('active');\n            $('.nav-tabs li a[href=\"' + hash + '\"]').parent().addClass('active');\n            $('.tab-content ' + hash).addClass('active');\n            $('#configuration_form').attr('action', window.location.href);\n            Ingenico.connectExistingAccount();\n        }\n\n        $('.nav-tabs li a').click(function () {\n            let hash = this.href.split(\"#\")[1];\n            window.location.hash = hash;\n            $('#configuration_form').attr('action', window.location.href);\n\n            let panel = $('#content.bootstrap .ingenico-settings .form-wrapper .panel-footer');\n            if (hash === 'support') {\n                // Hide Save button in bottom\n                panel.hide();\n            } else {\n                panel.show();\n            }\n        });\n\n        $(document).keydown(function(e) {\n            if (e.keyCode == 9) {  //tab pressed\n                if($('.modal-backdrop').is(\":visible\")) {\n                    e.preventDefault(); // stops its action\n                }\n            }\n            if (e.keyCode == 27) {  //esc pressed\n                Ingenico.closeModal();\n            }\n        });\n\n        //Disable account registration submit button\n        //if terms agreement checkbox unchecked\n        var the_terms = $('#agreement');\n        if (the_terms.is(\":checked\")) {\n            $('#registration-btn').removeAttr('disabled').removeClass('disabled');\n        } else {\n            $('#registration-btn').attr('disabled', 'disabled').addClass('disabled');\n        }\n        the_terms.click(function() {\n            if ($(this).is(\":checked\")) {\n                $('#registration-btn').removeAttr('disabled').removeClass('disabled');\n            } else {\n                $('#registration-btn').attr('disabled', 'disabled').addClass('disabled');\n            }\n        });\n\n        $('[name=submit_save_countries]').click(function(e) {\n            e.preventDefault();\n            Ingenico.addCountries();\n        });\n\n        $(document).on( 'click', '.paymentpage_template input[type=file]', function (e) {\n            let el = $(this);\n\n            var filename = el.split('\\\\').pop();\n            $('.paymentpage_template .upload-label').html(filename);\n        } );\n    },\n\n    pattern : /[a-zA-Z0-9_\\-\\+\\.]/,\n\n    getRandomByte : function()\n    {\n        if(window.crypto && window.crypto.getRandomValues)\n        {\n            var result = new Uint8Array(1);\n            window.crypto.getRandomValues(result);\n            return result[0];\n        }\n        else if(window.msCrypto && window.msCrypto.getRandomValues)\n        {\n            var result = new Uint8Array(1);\n            window.msCrypto.getRandomValues(result);\n            return result[0];\n        }\n        else\n        {\n            return Math.floor(Math.random() * 256);\n        }\n    },\n\n    generateHash : function(field, length)\n    {\n        let generated_hash = Array.apply(null, {'length': length})\n            .map(function()\n            {\n                var result;\n                while(true)\n                {\n                    result = String.fromCharCode(this.getRandomByte());\n                    if(this.pattern.test(result))\n                    {\n                        return result;\n                    }\n                }\n            }, this)\n            .join('');\n\n        document.getElementsByName(field)[0].value = generated_hash;\n    },\n\n    copyValue: function (field, copy_response_container) {\n        let el = document.createElement('textarea');\n        let value = document.getElementsByName(field)[0].value;\n        el.value = value;\n        el.setAttribute('readonly', '');\n        el.style = {position: 'absolute', left: '-9999px'};\n        document.body.appendChild(el);\n        el.select();\n        document.execCommand('copy');\n        document.body.removeChild(el);\n        $(\".copy-response[data-copy='\" + copy_response_container +\"']\").slideDown();\n        setTimeout(function(){\n            $(\".copy-response[data-copy='\" + copy_response_container +\"']\").slideUp();\n        }, 3000);\n    },\n\n    copyLink: function (link, copy_response_container) {\n        var el = document.createElement('textarea');\n        el.value = link;\n        el.setAttribute('readonly', '');\n        el.style = {position: 'absolute', left: '-9999px'};\n        document.body.appendChild(el);\n        el.select();\n        document.execCommand('copy');\n        document.body.removeChild(el);\n        $(\".copy-response[data-copy='\" + copy_response_container +\"']\").slideDown();\n        setTimeout(function(){\n            $(\".copy-response[data-copy='\" + copy_response_container +\"']\").slideUp();\n        }, 6000);\n    },\n\n    toggleTooltip: function (tooltip) {\n        let x = document.getElementById(tooltip);\n        if (x.style.display === 'none') {\n            x.style.display = 'block';\n        } else {\n            x.style.display = 'none';\n        }\n    },\n\n    /**\n     * Open Bootstrap Modal\n     *\n     * @param modal_id\n     * @param options\n     * @param onShow\n     * @return {jQuery|HTMLElement}\n     */\n    openModal: function (modal_id, options, onShow) {\n        if (typeof options === 'undefined') {\n            options = {};\n        }\n\n        if (typeof onShow === 'undefined') {\n            onShow = function () {};\n        }\n\n        let elm = $('#' + modal_id),\n            offset = $(window).scrollTop() - 250;\n\n        // Show modal\n        elm.find('.modal-dialog').addClass('modal-dialog-scrollable');\n        elm.modal(options);\n        elm.on('shown.bs.modal', function () {\n            //$('body').css('overflow', 'auto');\n            //elm.addClass('in');\n            //elm.css('top', offset + 'px');\n\n            // @todo\n            //$.scrollTo(elm);\n\n            $(\"html, body\").animate({ scrollTop: 0 }, \"slow\");\n\n            onShow();\n        });\n\n        elm.on('hide.bs.modal', function () {\n            //elm.removeClass('in').hide();\n            //$('.modal-backdrop').hide();\n        });\n\n        return elm;\n    },\n\n    /**\n     * Close Bootstrap Modal\n     *\n     * @param modal_id\n     * @param onClose\n     * @return {jQuery|HTMLElement}\n     */\n    closeModal: function (modal_id, onClose) {\n        let elm = $('.ingenico-modal');\n\n        if (typeof modal_id !== 'undefined' || !modal_id) {\n            elm = $('#' + modal_id);\n        }\n\n        if (typeof onClose === 'undefined') {\n            onClose = function () {};\n        }\n\n        elm.modal('hide');\n        elm.on('hide.bs.modal', function () {\n            //onClose();\n        });\n\n        setTimeout(function () {\n            onClose();\n        }, 300);\n\n        return elm;\n\n        //$(modal + '.ingenico-modal').removeClass('in').hide();\n        //$('.modal-backdrop').hide();\n        //$(modal + '.ingenico-modal').modal('hide')\n        //elm.on('hide.bs.modal', function () {\n        //    elm.removeClass('in').hide();\n        //    $('.modal-backdrop').hide();\n        //});\n    },\n\n    filterCountries: function (query) {\n        var selected_countries = '';\n        $('#countries-list [type=\"checkbox\"]:checked').each(function() {\n            selected_countries += this.value + '|';\n        }).promise().done(function() {\n            $.ajax(ingenico_ajax_url, {\n                'method': 'POST',\n                'data': {\n                    query : query,\n                    method: 'filter_countries',\n                    selected_countries: selected_countries\n                },\n                'dataType': 'json'\n            }).success(function(data) {\n                $('#countries-list ul').html(data);\n            });\n        });\n    },\n\n    filterPaymentMethods: function (query) {\n        $.ajax(ingenico_ajax_url, {\n            'method': 'POST',\n            'data': {\n                query : query,\n                method: 'filter_payment_methods'\n            },\n            'dataType': 'json'\n        }).success(function(data) {\n            $('#payment-methods-list ul').html(data);\n\n            Ingenico.getSelectedPaymentMethods(function (payment_methods) {\n                Ingenico.disableAfterpayOrKlarnaMethods(payment_methods);\n            });\n        });\n    },\n\n    /**\n     * Get Selected Payment Methods\n     * @param callback\n     */\n    getSelectedPaymentMethods: function(callback) {\n        // @see #selected_payment_methods\n        let payment_methods = $(\"#pm_list\").val();\n\n        // Append new methods\n        Ingenico.getModalPaymentMethods(function (selected) {\n            let result = payment_methods.concat(selected);\n            callback(result);\n        });\n    },\n\n    /**\n     * Get Selected Payment Methods in Modal\n     * @param callback\n     */\n    getModalPaymentMethods: function (callback) {\n        let payment_methods = [];\n\n        $('#payment-methods-list input[name=\"payment_methods[]\"]:checked').each(function () {\n            let method = $(this).val();\n            payment_methods.push(method);\n        }).promise().done(function() {\n            callback(payment_methods);\n        });\n    },\n\n    /**\n     * Disable Afterpay or Klarna in Payment List Modal\n     * @param payment_methods\n     */\n    disableAfterpayOrKlarnaMethods: function(payment_methods) {\n        // Disallow usage of Afterpay and Klarna in one time\n        let afterpay = $('#payment-methods-list input[value=\"afterpay\"]'),\n            klarna = $('#payment-methods-list input[value=\"klarna\"]'),\n            all = $('#payment-methods-list input[name=\"payment_methods[]\"]');\n\n        if (payment_methods.includes('afterpay')) {\n            afterpay.prop('disabled', false).removeClass('disabled');\n            klarna.prop('disabled', true).addClass('disabled');\n        } else if (payment_methods.includes('klarna')) {\n            klarna.prop('disabled', false).removeClass('disabled');\n            afterpay.prop('disabled', true).addClass('disabled');\n        } else {\n            all.prop('disabled', false).removeClass('disabled');\n        }\n    },\n\n    removePaymentMethod: function (payment_method) {\n        $(\"#pm_list option[value='\" + payment_method + \"']\").remove();\n        $('li.' + payment_method).fadeOut(1000, function() {\n            $(this).remove();\n        });\n    },\n\n    addPaymentMethod: function () {\n        // Currently selected methods\n        Ingenico.getSelectedPaymentMethods(function (payment_methods) {\n            $.ajax(ingenico_ajax_url, {\n                'method': 'POST',\n                'data': {\n                    payment_methods: payment_methods,\n                    method: 'fetch_payment_methods'\n                },\n                'dataType': 'json'\n            }).success(function(data) {\n                $('#selected_payment_methods').html(data);\n                Ingenico.closeModal('payment-methods-list');\n            });\n        });\n    },\n\n    getPaymentMethodModal: function () {\n        // Currently selected methods\n        let payment_methods = $(\"#pm_list\").val();\n\n        $.ajax(ingenico_ajax_url, {\n            'data': {\n                method: 'payment_method_modal',\n                selected: payment_methods\n            },\n            'dataType': 'json'\n        }).success(function(data) {\n            $('#payment-methods-list .methods-list').html(data);\n\n            Ingenico.getSelectedPaymentMethods(function (payment_methods) {\n                Ingenico.disableAfterpayOrKlarnaMethods(payment_methods);\n            });\n\n        });\n    },\n\n    hasSomeParentTheClass: function(element, classname) {\n        if(element.tagName === 'HTML') {\n            return false;\n        }\n        if (element.className.split(' ').indexOf(classname) >= 0) {\n            return true;\n        }\n\n        return element.parentNode && this.hasSomeParentTheClass(element.parentNode, classname);\n    },\n\n    showMigrationUI: function() {\n        $('.installation-options').hide();\n        $('#migration-frm').show();\n        $('#create-account-frm').hide();\n        $('#configuration_form').hide();\n        $('.ingenico-settings, .ingenico-header').addClass('install');\n        //$('.installation-view').show();\n        //$('.settings-form').hide();\n        $('.account-creation-progress .progress-half').addClass('active');\n\n        // Header links\n        $('.header-links').show();\n        $('.create-account.creation').hide();\n        $('.create-account.configuration').show();\n        $('.create-account-form .panel-footer').show();\n    },\n    \n    createAccount: function () {\n        $('.installation-options').hide();\n        $('.create-account-form').show();\n        $('.ingenico-settings, .ingenico-header').addClass('install');\n        $('.installation-view').show();\n        $('.settings-form').hide();\n        $('.account-creation-progress .progress-half').addClass('active');\n\n        // Header links\n        $('.header-links').show();\n        $('.create-account.creation').hide();\n        $('.create-account.configuration').show();\n        $('.create-account-form .panel-footer').show();\n\n        $('#migration-frm').hide();\n    },\n    \n    connectExistingAccount: function () {\n        $('.installation-options').hide();\n        $('.settings-form').css('display', 'grid');\n        $('.ingenico-header .btn-toolbar').show();\n        $('.ingenico-settings, .ingenico-header').removeClass('install');\n        $('.installation-view').hide();\n        $('.registration-complete').hide();\n        $('.account-creation-progress, .ingenico-header').removeClass('done');\n        $('.header-links').show();\n\n        // Header links\n        $('.create-account.creation').show();\n        $('.create-account.configuration').hide();\n    },\n\n    backToInstallation: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n\n        $('.installation-view').show();\n        $('.installation-options').show();\n        $('.create-account-form').hide();\n        $('.account-creation-progress .progress-half').removeClass('active');\n\n        // Header links\n        $('.header-links').show();\n        $('.create-account.creation').hide();\n        $('.create-account.configuration').show();\n    },\n\n    registerAccount: function (e) {\n        if ($('.installation-form [name=company_name]').val().length > 0 &&\n            this.validateEmail($('.installation-form [name=account_email]').val()) &&\n            $('.installation-form #agreement').is(\":checked\")) {\n            e.preventDefault();\n            $.ajax(ingenico_ajax_url, {\n                'data': {\n                    method: 'register_account',\n                    account_info: $('.installation-form').serialize()\n                },\n                'dataType': 'json'\n            }).success(function(data) {\n                $('.installation-form').hide();\n                $('.registration-complete').css('display', 'inline-block');\n                $('.account-creation-progress .progress-half').removeClass('active');\n                $('.account-creation-progress, .ingenico-header').addClass('done');\n            });\n        } else {\n            return false;\n        }\n    },\n\n    validateEmail: function (email) {\n        var pattern = /^([\\w-\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([\\w-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\\]?)$/;\n\n        return $.trim(email).match(pattern) ? true : false;\n    },\n\n    addCountries: function () {\n        var countries = [];\n        var openinvoice_countries = [];\n        $('#countries-list [type=checkbox]').each(function () {\n            if (this.checked) {\n                const country_code = $(this).val(),\n                    label = $(this).closest('.label-container').text();\n\n                // Get country name of OpenInvoice\n                if (['SE', 'FI', 'DK', 'NO','DE', 'NL'].indexOf(country_code) > -1) {\n                    openinvoice_countries.push(label);\n                }\n\n                countries.push(country_code);\n\n            }\n        }).promise().done( function() {\n            if ((countries.indexOf('DE') > -1 || countries.indexOf('NL') > -1) && typeof window.OPENINVOICE_METHOD === 'undefined') {\n                let label = $('#openinvoice_selected2').html();\n                $('#openinvoice_selected2').html(label.replace('%country%', openinvoice_countries.join(', ')));\n\n                Ingenico.closeModal(false, function () {\n                    Ingenico.openModal('openinvoice-select-payment-modal');\n                });\n\n            } else {\n                Ingenico.fetchPaymentMethods(countries, window.OPENINVOICE_METHOD);\n            }\n        } );\n    },\n\n    fetchPaymentMethods: function (countries, openinvoice_method) {\n        return $.ajax(ingenico_ajax_url, {\n            'method': 'POST',\n            'data': {\n                countries: countries,\n                method: 'fetch_methods_by_countries',\n                openinvoice: openinvoice_method\n            },\n            'dataType': 'json'\n        }).success(function(data) {\n            $('#selected_payment_methods').html(data);\n            Ingenico.closeModal('countries-list');\n        });\n    },\n\n    /**\n     * Add message to migration log\n     * @param message\n     */\n    addMigrationLog: function(message) {\n        let el = $('#migration-logs');\n        el.append(message + \"\\r\\n\");\n        el.scrollTop(el[0].scrollHeight - el.height());\n    },\n\n    /**\n     * Call AJAX Request\n     * @param action\n     * @param callback\n     * @return {*}\n     */\n    doMigrationAction: function(action, callback) {\n        return $.ajax(window.migration_ajax_url, {\n            data: {\n                action: action\n            },\n            dataType: 'json'\n        }).done(function(data) {\n            data.data.forEach(function(item, index, arr) {\n                Ingenico.addMigrationLog(item);\n            });\n\n            if (!data.success) {\n                callback(data.data, data);\n            } else {\n                callback(null, data);\n            }\n\n        }).fail(function (jqXHR, textStatus, errorThrown) {\n            Ingenico.addMigrationLog(JSON.stringify(errorThrown));\n            callback(errorThrown, {});\n        });\n    },\n\n    /**\n     * Start Migration\n     */\n    doMigrate: function () {\n        async.series({\n            step1: function(callback) {\n                Ingenico.doMigrationAction('step1', callback);\n            },\n            step2: function(callback) {\n                Ingenico.doMigrationAction('step2', callback);\n            },\n            step3: function(callback) {\n                Ingenico.doMigrationAction('step3', callback);\n            },\n            step4: function(callback) {\n                Ingenico.doMigrationAction('step4', callback);\n            },\n            step5: function (callback) {\n                Ingenico.addMigrationLog('Import Aliases...');\n                Ingenico.doMigrationAction('aliases_info', function (err, data) {\n                    var aliases = data.aliases,\n                        aliases_count = aliases.length,\n                        aliases_imported = 0;\n\n                    // Process Aliases\n                    async.eachSeries(aliases, function(alias_id, callback1) {\n                        Ingenico.addMigrationLog('Import alias #' + alias_id);\n\n                        // Import Alias\n                        $.ajax(window.migration_ajax_url, {\n                            data: {\n                                action: 'import_alias',\n                                alias_id: alias_id\n                            },\n                            dataType: 'json'\n                        }).done(function(data1) {\n                            Ingenico.addMigrationLog('Alias #' + alias_id + ' was imported');\n                        }).always(function () {\n                            aliases_imported++;\n                            console.log(aliases_imported);\n                            console.log(aliases_count);\n\n                            const value1 = Math.floor(aliases_imported / aliases_count * 100);\n                            $('#aliases_progress').css('width', value1 + '%').attr('aria-valuenow', value1);\n\n                            callback1();\n                        });\n                    }, function(err) {\n                        if (err) {\n                            console.log(err);\n                        }\n\n                        callback();\n                    });\n                });\n            },\n            step6: function (callback) {\n                Ingenico.doMigrationAction('finish', callback);\n            }\n        }, function(err, results) {\n            // results is now equal to: {one: 1, two: 2}\n            console.log(results);\n            Ingenico.addMigrationLog('Finished');\n        });\n    }\n};\n\n$(function() {\n    Ingenico.init();\n});\n"]}